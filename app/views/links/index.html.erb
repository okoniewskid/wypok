<%= stylesheet_link_tag "/assets/link.css" %>
<%= stylesheet_link_tag "/assets/miniature.css" %>
<%= stylesheet_link_tag "/assets/text.css" %>

<%= form_tag(links_path, :method => "get") do %>
  <ul class="nav navbar-nav pull-left">
    <li>
      <div class="input-group">
        <%= text_field_tag :search, params[:search], class: "form-control", placeholder: "Szukaj" %>
        <span class="input-group-btn">
          <button type="submit" class="btn btn-default btn-outline"><span class="glyphicon glyphicon-search"></span></button>
        </span>
      </div>
    </li>
  </ul>
  </br></br>
  <% if @sd %>
    <button type="submit" class="btn-link" name="sortDate" value="desc">Sortuj wg daty (malejąco)</button></br>
  <% else %>
    <button type="submit" class="btn-link" name="sortDate" value="asc">Sortuj wg daty (rosnąco)</button></br>
  <% end %>
  <% if @sn %>
    <button type="submit" class="btn-link" name="sortName" value="desc">Sortuj wg nazwy (malejąco)</button></br>
  <% else %>
    <button type="submit" class="btn-link" name="sortName" value="asc">Sortuj wg nazwy (rosnąco)</button></br>
  <% end %>
  <% if @sv %>
    <button type="submit" class="btn-link" name="sortVote" value="asc">Sortuj wg oceny (rosnąco)</button></br>
  <% else %>
    <button type="submit" class="btn-link" name="sortVote" value="desc">Sortuj wg oceny (malejąco)</button></br>
  <% end %>
<% end %>
<%= will_paginate @links, :previous_label => 'Poprzedni', :next_label => 'Następny', renderer: BootstrapPagination::Rails %>
<% @links.each do |link| %>
  <div class="link row clearfix">
    <h2>
      <%= link_to link.title, link %>
      <font size="2">
        <%= (link.ci_lower_bound(link.get_upvotes.size, link.get_upvotes.size+link.get_downvotes.size, 0.95)*0.1).round(2) %>/10
      </font>
      <br>
      <font size="5">
        <%= sanitize link.description, tags: %w(b i u s a br)%>
      </font>
      <br>
      <a href="<%= link.url %>" target="_blank" title="<%= link.title %>" ><img src="<%= link.generate_image(link) %>" class="miniaturka" ></a>
      <br>
      <font size="4">
        <small class="author">Przesłano <%= time_ago_in_words(link.created_at) %> przez <%= link_to link.user.name, link.user %></small>
      </font>
    </h2>

    <div class="btn-group">
      <a class="btn btn-default btn-sm" href="<%= link.url %>", target="_blank">Podgląd</a>
      <% if user_signed_in? %>
        <%= link_to like_link_path(link), method: :put, class: "btn btn-default btn-sm" do %>
          <span class="glyphicon glyphicon-chevron-up"></span>
          <%= link.get_upvotes.size %>
        <% end %>
        <%= link_to dislike_link_path(link), method: :put, class: "btn btn-default btn-sm" do %>
          <span class="glyphicon glyphicon-chevron-down"></span>
          <%= link.get_downvotes.size %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
<%= will_paginate @links, :previous_label => 'Poprzedni', :next_label => 'Następny', renderer: BootstrapPagination::Rails %>